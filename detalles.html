<!DOCTYPE html>
<html lang="es">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,600|Passion+One" rel="stylesheet">
      <link rel="stylesheet" href="css/estilos.css">
      <title>Marvel Comic</title>
   </head>
   <body>
      <header>
         <div class="contenedor">
            <nav class="menu">
               <a class="page" href="index.html" id="btn-acerca-de">Inicio</a>
               <a class="page" href="busqueda.html" id="btn-busqueda">Busqueda</a>
               <a class="page" href="nosotros.html" id="btn-nosotros">Nosotros</a>
            </nav>
            <div class="textos">
               <h1 class="nombre"><span>Marvel</span> Comics</h1>
               <h3>Todo sobre marvel Comics</h3>
            </div>
         </div>
      </header>
      <section>
      <div class="main contenedor">
         <div id="resultados"></div>
      </div>
      </section>
      <footer>
         <div class="contenedor">
            <div class="copyright">
               <p>Copyright MatiasBenary 2018</p>
            </div>
         </div>
      </footer>
      <script src="js/jquery.js"></script>
      <script src="js/general.js"></script>
      <script>
         $(document).ready(function() {
         	function getRequest(key){
            			key = key.replace(/[\[]/, '\\[');  
                 key = key.replace(/[\]]/, '\\]');  
                 var pattern = "[\\?&]" + key + "=([^&#]*)";  
                 var regex = new RegExp(pattern);  
                 var url = unescape(window.location.href);  
                 var results = regex.exec(url);  
                 if (results === null) {  
                     return null;  
                 } else {  
                     return results[1];  
                 }  
             }  
	         
	         id = getRequest('id');
	         
	         if(id){
	         	var key = 'ts=1&apikey=4cc4ad6ac17b1e0d8cf0b785d1367511&hash=0425c79019517b0f72a911ff47a5bd12';
	         
	         	var url = "https://gateway.marvel.com/v1/public/comics/"+id+"?"+key;
	         	var urlPj = "https://gateway.marvel.com/v1/public/comics/"+id+"/characters?"+key;
	         	var urlCr = "https://gateway.marvel.com/v1/public/comics/"+id+"/creators?"+key;
	         	cardsHtml= {}
				var comic = [];
				var pjs = [];
				var cr = [];
	         	$.ajaxSetup({
	         		async: false,
	         	});
	         	
	         	
	         	$.get(url,function(data){   
	         		comic=data.data.results[0]; 
	            });

	            $.get(urlPj,function(data){
	            	pjs = data.data.results;
	            });

	            $.get(urlCr,function(data){
	            	crs = data.data.results;
	            });

	           	console.log(crs);

	        	card = {}
	     		card.title = comic['title'];
	     		card.description = comic['description']?comic['description']: "Sin descripciòn";
	     		card.img = (comic.thumbnail.path + "." + comic.thumbnail.extension);
	     		card.price = comic['prices'][0]['price'];
	     		card.fecha = comic['dates'][0]['date'].substring(0, 10);
	     		cardsHtml = 
	     		'<div class="card2">'+
	      			'<h4><b>'+card.title+'</b></h4>'+
	  				'<p class="descripcion">'+card.description+'</p>'+
	  				'<br/>'+
	  				'<img src="'+ card.img +'" alt="Avatar" style="width:100%">'+
	  				'<p class="especifico">Fecha de publicacion: '+ card.fecha +'</p>'+ 
			   		'<p class="especifico">Precio: $'+ card.price+'</p>'

			   	if(pjs.length){
			   		cardsHtml = cardsHtml+
			         	'<div class="personajes">'+
			         	'<p class="title">Personajes:</p>';

			   		for(var x=0; x<pjs.length; x++){
			         	pj=pjs[x];
			         	img = (pj.thumbnail.path + "." + pj.thumbnail.extension);
			         	console.log(pj.thumbnail.path);
			         	cardsHtml = cardsHtml+
		         		'<div class="personaje">'+
		         			'<h4 class="nombre">'+pj.name+'</h4>'+
		         			'<div>'+
	               				'<img src="'+ img +'" alt="Avatar" style="width:100%">'+
		         		  	'</div>'+	
		         		'</div>';
			        }
					cardsHtml = cardsHtml+
			         	'</div>'

			   	}

			   	if(crs.length){
			   		cardsHtml = cardsHtml+
			         	'<div class="personajes">'+
			         	'<p class="title">Creadores:</p>';

			   		for(var x=0; x<crs.length; x++){
			         	cr=crs[x];
			         	img = (cr.thumbnail.path + "." + cr.thumbnail.extension);
			         	console.log(pj.thumbnail.path);
			         	cardsHtml = cardsHtml+
		         		'<div class="personaje">'+
		         			'<h4 class="nombre">'+cr.fullName+'</h4>'+
		         			'<div>'+
	               				'<img src="'+ img +'" alt="Avatar" style="width:100%">'+
		         		  	'</div>'+	
		         		'</div>';
			        }
					cardsHtml = cardsHtml+
			         	'</div>'

			   	}
			   	emailAsunto = encodeURI('Encontre info sobre: '+card.title);
			   	emailCuerpo = encodeURI('Descripciòn: \n'+card.description+'\npara mas conocer más de sus creadores y personaje no olvides visitar : \n'+ window.location.hostname+ window.location.href);

			   	cardsHtml =  cardsHtml + 
			   	'<a href="mailto:?subject='+emailAsunto+'&body='+emailCuerpo+'">Compartir</a>';

	            $("#resultados").html(cardsHtml+'</div>');
	            	
	            }

	       
         });    
      </script>
   </body>
</html>
